/*
Publishes the afu hazard data (model SO_AfU_Gefahrenkartierung) to GDI publication and the KKGEO AI.
Process:
1. Create layers gk_synoptisch, gk_mgdm and ik_synoptisch_mgdm
2. Publish to GDI Pub-DB

Class mapping between the models:
- Erhebungsgebiet --> assessment_area
- GK_MGDM --> hazard_area
- IK_synoptisch_MGDM --> synoptic_intensity
*/

import ch.so.agi.gretl.tasks.*
import ch.so.agi.gretl.api.TransferSet

import java.nio.file.Files
import java.nio.file.Paths
import java.io.File

defaultTasks 'pubGefkart'

task createLayer(type: Db2Db){
    sourceDb = [dbUriEdit, dbUserEdit, dbPwdEdit]
    targetDb = [dbUriEdit, dbUserEdit, dbPwdEdit]
    transferSets = [
        new TransferSet('createlayers/create_gk_synoptisch_generiert.sql', 'afu_gefahrenkartierung.gefahrenkartirung_gk_synoptisch_generiert', true),
        new TransferSet('createlayers/create_gk_mgdm_sturz.sql', 'afu_gefahrenkartierung.gefahrenkartirung_gk_mgdm', true),
        new TransferSet('createlayers/create_gk_mgdm_wasser.sql', 'afu_gefahrenkartierung.gefahrenkartirung_gk_mgdm', false),
        new TransferSet('createlayers/create_gk_mgdm_rutsch.sql', 'afu_gefahrenkartierung.gefahrenkartirung_gk_mgdm', false),
        new TransferSet('createlayers/create_ik_syn_mgdm_ufererosion.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', true),
        new TransferSet('createlayers/create_ik_syn_mgdm_murgang.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', false),
        new TransferSet('createlayers/create_ik_syn_mgdm_absenkung_einsturz.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', false),
        new TransferSet('createlayers/create_ik_syn_mgdm_felssturz_bergsturz.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', false),
        new TransferSet('createlayers/create_ik_syn_mgdm_hangmure.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', false),
        new TransferSet('createlayers/create_ik_syn_mgdm_kontinuierliche_rutschung.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', false),
        new TransferSet('createlayers/create_ik_syn_mgdm_spontane_rutschung.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', false),
        new TransferSet('createlayers/create_ik_syn_mgdm_steinschlag_blockschlag.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', false),
        new TransferSet('createlayers/create_ik_syn_mgdm_ueberflutung.sql', 'afu_gefahrenkartierung.gefahrenkartirung_ik_synoptisch_mgdm', false)
    ];    
}

task pubGefkart(type: Db2Db){
    sourceDb = [dbUriEdit, dbUserEdit, dbPwdEdit]
    targetDb = [dbUriPub, dbUserPub, dbPwdPub]
    transferSets = [
        new TransferSet('pub/perimeter_gefahrenkartierung.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_perimeter_gefahrenkartierung', true),
        new TransferSet('pub/gk_synoptisch_generiert.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_gk_synoptisch_generiert', true),
        new TransferSet('pub/gk_absenkung_einsturz.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_gk_absenkung_einsturz', true),
        new TransferSet('pub/gk_hangmure.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_gk_hangmure', true),
        new TransferSet('pub/gk_rutsch_spontan.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_gk_rutsch_spontan', true),
        new TransferSet('pub/gk_rutsch_kont_sackung.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_gk_rutsch_kont_sackung', true), 
        new TransferSet('pub/gk_sturz.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_gk_sturz', true), 
        new TransferSet('pub/gk_wasser.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_gk_wasser', true),
        new TransferSet('pub/prozessquelle_wasser.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_prozessquelle_wasser', true),
        new TransferSet('pub/prozessquelle_sturz.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_prozessquelle_sturz', true),    
        new TransferSet('pub/punktsignatur.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_punktsignatur', true),
        new TransferSet('pub/ik_absenkung_einsturz.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_ik_absenkung_einsturz', true), 
        new TransferSet('pub/ik_hangmure.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_ik_hangmure', true), 
        new TransferSet('pub/ik_sturz.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_ik_sturz', true), 
        new TransferSet('pub/ik_rutsch_kont_sackung.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_ik_rutsch_kont_sackung', true), 
        new TransferSet('pub/ik_rutsch_spontan.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_ik_rutsch_spontan', true), 
        new TransferSet('pub/ik_wasser.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_ik_wasser', true), 
        new TransferSet('pub/ueberflutungskarte.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_ueberflutungskarte', true),
        new TransferSet('pub/ik_synoptisch_mgdm.sql', 'afu_gefahrenkartierung_pub.gefahrenkartirung_ik_synoptisch_mgdm', true)        	
    ];    
}
