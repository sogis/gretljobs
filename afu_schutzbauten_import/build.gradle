import ch.so.agi.gretl.tasks.*
import java.io.File

apply plugin: 'ch.so.agi.gretl'

defaultTasks 'importXtFile'

// Extract the datasetname from the filename. The filename must match
// something like ch.so.AMT.BFS_202403041441.xtf.
def datasetname = xtfFilename.findAll("ch.so.[a-zA-Z]+\\.[a-zA-Z0-9]+")[0]

/**
 *
 */
task validateImportFile(type: IliValidator) {
    description = "Validiere die Import Datei"
    dataFiles = file(xtfFilename)
    if (findProperty('ilivalidatorModeldir')) modeldir = ilivalidatorModeldir
}

/**
 *
 */
task importXtfFile(type: Ili2pgReplace) {
    dependsOn validateImportFile
    description = 'Import das XTF (Herkunft von Planungsb√ºros) einer Gemeinde in das Schema "afu_schutzbauten_v1".'
    database = [dbUriEdit, dbUserEdit, dbPwdEdit]
    dbschema = 'afu_schutzbauten_v1'
    models = 'SO_AFU_Schutzbauten_20231212'
    deleteData= true
    dataset = datasetname
    dataFile = xtfFilename
    doLast {
        println "Dataset \"" + datasetname + "\" has been replaced."
    }
}
