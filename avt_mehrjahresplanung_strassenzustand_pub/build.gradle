import ch.so.agi.gretl.tasks.*

apply plugin: 'ch.so.agi.gretl'

defaultTasks 'validateData'

task emptyTable(type: SqlExecutor) {
    description = "Leere die Datenbanktabelle"
    database = [dbUriPub, dbUserPub, dbPwdPub]
    sqlFiles = ['delete_strassenzustand.sql']
}

task importFile(type: ShpImport) {
    dependsOn emptyTable
    description = "Importiere das Shapefile"
    database = [dbUriPub, dbUserPub, dbPwdPub]
    schemaName = "avt_mehrjahresplanung_pub_v1"
    tableName = "strassenzustand"
    dataFile = shpFilename 
}

task fixData(type: SqlExecutor) {
    dependsOn importFile
    description = "Bereinige die Daten"
    database = [dbUriPub, dbUserPub, dbPwdPub]
    sqlFiles = ['update_strassenzustand.sql']
}

task validateData(type: Ili2pgValidate) {
    dependsOn fixData
    database = [dbUriPub, dbUserPub, dbPwdPub]
    models = "SO_AVT_Mehrjahresplanung_Publikation_20240911"
    modeldir = rootProject.projectDir.toString() + ";http://models.interlis.ch"
    dbschema = "avt_mehrjahresplanung_pub_v1"
    failOnException = false
}

/**
task validateImportFile(type: ShpValidator) {
//description = "Validiere die Import Datei"
models = "SO_AVT_Mehrjahresplanung_Strassenzustand_Publikation_20240911"
modeldir = "avt_mehrjahresplanung_strassenzustand_pub;https://geo.so.ch/models/"
dataFiles = [ shpFilename ]
encoding = "UTF-8"
}
 **/