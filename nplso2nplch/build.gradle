import ch.so.agi.gretl.tasks.*
import java.nio.file.Paths

apply plugin: 'ch.so.agi.gretl'

defaultTasks 'exportLaermempfindlichkeit'

def pathToTempFolder = System.getProperty("java.io.tmpdir")
def xtfFilePath = Paths.get(pathToTempFolder.toString(), 'Nutzungsplanung_LV95_V1_1.itf')

task transferNplso2Nplch(type: SqlExecutor) {
    database = [dbUriSogis, dbUserSogis, dbPwdSogis]
    sqlFiles = [
            'arp_npl_mgdm_geobasisdaten_typ_kt.sql',
            'arp_npl_mgdm_geobasisdaten_typ.sql',
            'arp_npl_mgdm_geobasisdaten_grundnutzung_zonenflaeche.sql',
            'arp_npl_mgdm_geobasisdaten_linienbezogene_festlegung.sql',
            'arp_npl_mgdm_geobasisdaten_objektbezogene_festlegung.sql',
            'arp_npl_mgdm_geobasisdaten_ueberlagernde_festlegung.sql',
            'arp_npl_mgdm_rechtsvorschrften_dokument.sql',
            'arp_npl_mgdm_rechtsvorschrften_hinweisweiteredokumente.sql',
            'arp_npl_mgdm_geobasisdaten_typ_dokument.sql',
            'arp_npl_mgdm_multilingualuri.sql',
            'arp_npl_mgdm_localiseduri.sql'
    ]
}

task transferNplso2Laermempfindlichkeit(type: SqlExecutor, dependsOn: 'transferNplso2Nplch'){
    database = [dbUriSogis, dbUserSogis, dbPwdSogis]
    sqlFiles = [
            'arp_laermempfindlichkeit_mgdm_geobasisdaten_typ.sql',
            'arp_laermempfindlichkeit_mgdm_rechtsvorschrften_dokument.sql',
            'arp_laermempfindlichkeit_mgdm_geobasisdaten_laermempfindlichkeit_zonenflaeche.sql',
            'arp_laermempfindlichkeit_mgdm_rechtsvorschrften_hinweisweiteredokumente.sql',
            'arp_laermempfindlichkeit_mgdm_geobasisdaten_typ_dokument.sql',
            'arp_laermempfindlichkeit_mgdm_multilingualuri.sql',
            'arp_laermempfindlichkeit_mgdm_localiseduri.sql'
    ]
}

task exportNplch(type: Ili2pgExport, dependsOn:'transferNplso2Laermempfindlichkeit') {
    database = [dbUriSogis, dbUserSogis, dbPwdSogis]
    dbschema = "arp_npl_mgdm"
    models = "Nutzungsplanung_LV95_V1_1"
    disableValidation = false
    dataFile = file(xtfFilePath)
}

task exportLaermempfindlichkeit(type: Ili2pgExport, dependsOn:'exportNplch') {
    database = [dbUriSogis, dbUserSogis, dbPwdSogis]
    dbschema = "arp_laermempfindlichkeit_mgdm"
    models = "Laermempfindlichkeitsstufen_LV95_V1_1"
    disableValidation = false
    dataFile = file(xtfFilePath)
}
