import ch.so.agi.gretl.api.TransferSet
import java.nio.file.Paths
import java.nio.file.Files
import ch.so.agi.gretl.tasks.*
import ch.so.agi.gretl.api.*
import de.undercouch.gradle.tasks.download.Download

apply plugin: 'ch.so.agi.gretl'
apply plugin: 'org.hidetake.ssh'

defaultTasks ':04_processing_data:last'

// global variables
ext {
    load_extension_spatial = "${rootProject.projectDir}/load_extension_spatial.sql"
    load_extension_httpfs = "${rootProject.projectDir}/load_extension_httpfs.sql"
    load_extension_postgres = "${rootProject.projectDir}/load_extension_postgres.sql"
    attach_editdb = "${rootProject.projectDir}/attach_editdb.sql"
    attach_pubdb = "${rootProject.projectDir}/attach_pubdb.sql"
    detach_editdb = "${rootProject.projectDir}/detach_editdb.sql"
    detach_pubdb = "${rootProject.projectDir}/detach_pubdb.sql"
    set_root_path = "${rootProject.projectDir}/set_root_path.sql"
    export_parquet = "${rootProject.projectDir}/export_parquet.sql"
    import_data_dir = "${rootProject.projectDir}/02_import_data/"

    // Create DB-variables for sql-files
    // user und password beziehen sich auf die lokalen gretljobs.properties. Funktioniert daher nur lokal.
    dbHostEdit = dbUriEdit.substring(dbUriEdit.indexOf("//") + 2, dbUriEdit.lastIndexOf("/"))
    dbDatabaseEdit = 'edit'
    dbConnectionStringEdit = "'dbname=$dbDatabaseEdit user=$dbUserEditS password=$dbPwdEditS host=$dbHostEdit'"

    dbHostPub = dbUriPub.substring(dbUriPub.indexOf("//") + 2, dbUriPub.lastIndexOf("/"))
    dbDatabasePub = 'pub'
    dbConnectionStringPub = "'dbname=$dbDatabasePub user=$dbUserPubS password=$dbPWdPubS host=$dbHostPub'"
}

ssh.settings {
    knownHosts = allowAnyHosts
}