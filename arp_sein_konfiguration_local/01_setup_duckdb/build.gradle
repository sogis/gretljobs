import ch.so.agi.gretl.api.TransferSet
import java.nio.file.Paths
import java.nio.file.Files
import ch.so.agi.gretl.tasks.*
import ch.so.agi.gretl.api.*
import de.undercouch.gradle.tasks.download.Download

apply plugin: 'ch.so.agi.gretl'
apply plugin: 'org.hidetake.ssh'

// variables
def dbPath = "$buildDir/sein.duckdb"
def dbUriDuckDB = "jdbc:duckdb:$dbPath"
def dbFile = new File(dbPath)

if (dbFile.exists()) {
    dbFile.delete()
}

// first task
tasks.register("first"){
}

// create Sammeltabelle
tasks.register('createSammelTabelle', SqlExecutor){
    dependsOn "first"
    database = [dbUriDuckDB]
    sqlParameters = [
        connectionStringEdit : dbConnectionStringEdit as String
        ]
    sqlFiles = files(
        load_extension_spatial,
        'create_sammeltabelle.sql'
    )
}

tasks.register("last"){
    dependsOn "createSammelTabelle"
}