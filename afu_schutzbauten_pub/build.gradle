import ch.so.agi.gretl.tasks.*
import ch.so.agi.gretl.api.TransferSet

apply plugin: 'ch.so.agi.gretl'

defaultTasks 'validatePubData'

task transferSchutzbautenobjekte(type: Db2Db){
    description = "Baue die Daten vom Erfassungsmodell ins Publikationsmodell um"
    sourceDb = [dbUriEdit, dbUserEdit, dbPwdEdit]
    targetDb = [dbUriPub, dbUserPub, dbPwdPub]
    transferSets = [
        new TransferSet(
            'select_schutzbautenobjekt_punkt.sql',
            'afu_schutzbauten_pub_v1.schutzbautenobjekt_punkt',
            true
        ),
        new TransferSet(
            'select_schutzbautenobjekt_linie.sql',
            'afu_schutzbauten_pub_v1.schutzbautenobjekt_linie',
            true
        ),
        new TransferSet(
            'select_schutzbautenobjekt_flaeche.sql',
            'afu_schutzbauten_pub_v1.schutzbautenobjekt_flaeche',
            true
        )
    ]
}

task validatePubData(type: Ili2pgValidate){
    dependsOn "transferSchutzbautenobjekte"
    description = "Validiere die Daten im Modell SO_AFU_Schutzbauten_Publikation_20231212"
    database = [dbUriPub, dbUserPub, dbPwdPub]
    models = "SO_AFU_Schutzbauten_Publikation_20231212"
    dbschema = "afu_schutzbauten_pub_v1"
}
