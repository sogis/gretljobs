import java.nio.file.Files
import java.nio.file.Paths
import java.io.File
import ch.so.agi.gretl.tasks.*

apply plugin: 'ch.so.agi.gretl'


defaultTasks 'importWaldplan'

// def pathToTempFolder = System.getProperty("java.io.tmpdir")
// def pathToUnzipFolder = Paths.get(pathToTempFolder, "unzip_data")
// def pathToDataFile = Paths.get(pathToTempFolder)
// def pathToDataZip = Paths.get(pathToTempFolder, 'data.zip')

def pathToShpFolder = Paths.get(System.getProperty("java.io.tmpdir"), "shapefile").toString() 
def uploadFile = 'upload/uploadFile'




task copyZipFile(type: Copy) {
    from "upload/"
    into "upload/"
    include("uploadFile")
    rename("uploadFile", "uploadFile.zip")
}
task unzipShape(type: Copy) {
    from zipTree(uploadFile)
    into "upload/"
}

// task validate(type: ShpValidator){
//     models = "SO_AWJF_Waldplan_Bestandeskarte_20230111"
//     dataFiles = ["data.shp"]                                                                                        //wie muss hier der Pfad definiert werden???????????????????????????
// }



task importWaldplan(type: ShpImport){
                                                                                                                    //task importWaldplan(type: ShpImport, dependsOn: unzipShape){
    database = [dbUriEdit, dbUserEdit, dbPwdEdit]
    schemaName = "awjf_waldplan_bestandeskarte_v1"
    tableName = "waldplan_bestandeskarte"
//     dataFile = file(pathToShpFolder.toString()+"import_waldplan.shp")
    dataFile = file("upload/wap_bst_es_sicherung_rode_221209_11.shp")
}
