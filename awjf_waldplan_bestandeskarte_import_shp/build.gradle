import ch.so.agi.gretl.api.TransferSet
import java.nio.file.Files
import java.nio.file.Paths
import java.io.File
import ch.so.agi.gretl.tasks.*


defaultTasks 'importWaldplan'


def shpName = 'wap_bst_es_sicherung_rode_221209_11.shp'
def pathToShpFolder = Paths.get(System.getProperty("java.io.tmpdir"), "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx").toString() 
def uploadFile = 'upload/uploadFile'

task unpackShapes(type: Copy) {
    from zipTree(uploadFile)
    into pathToShpFolder
}


// task validateShpFile(type: CsvValidator, dependsOn: unzipShape) {        // geht nicht wegen GeometryCHLV95_V1: model(s) not found
//     models = 'SO_AWJF_Waldplan_Bestandeskarte_20230111'
//     modeldir = System.getProperty('user.dir')                                                 // später löschen
// //     if (findProperty('ilivalidatorModeldir')) modeldir = ilivalidatorModeldir
//     modeldir = System.getProperty('user.dir')
//     dataFiles = [file('upload/wap_bst_es_sicherung_rode_221209_11.shp')]
// }
// 

task importWaldplan(type: ShpImport, dependsOn: unpackShapes){
    database = [dbUriEdit, dbUserEdit, dbPwdEdit]
    schemaName = 'awjf_waldplan_bestandeskarte_v1'
    tableName = 'waldplan_bestandeskarte'
    
    
    
    dataFile = Paths.get(pathToShpFolder, shpName) 
//     dataFile = file('upload/wap_bst_es_sicherung_rode_221209_11.shp')
}
