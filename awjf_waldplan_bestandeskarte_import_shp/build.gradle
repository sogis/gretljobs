import ch.so.agi.gretl.tasks.*
import ch.so.agi.gretl.api.TransferSet


defaultTasks 'importWaldplan'


task copyZipFile(type: Copy, dependsOn: deleteCsvTableRows) {
    from "upload/"
    into "upload/"
    include("uploadFile")
    rename("uploadFile", "uploadFile.zip")
}

task unzipShape(type: Copy, dependsOn: copyZipFile){
    from zipTree(file("upload/uploadFile.zip"))
    into file("upload")
//     include '**/*.*'
}

// task validate(type: ShpValidator){
//     models = 'SO_AWJF_Waldplan_Bestandeskarte_20230111'
//     dataFiles = ['data.shp']                                                                                        //wie muss hier der Pfad definiert werden???????????????????????????
// }

task validateShpFile(type: CsvValidator, dependsOn: unzipShape) {
    models = 'SO_AWJF_Waldplan_Bestandeskarte_20230111'
    dataFiles = [file('upload/wap_bst_es_sicherung_rode_221209_11.shp')]
}


task importWaldplan(type: ShpImport, dependsOn: 'validateShpFile'){
                                                                                                                    //task importWaldplan(type: ShpImport, dependsOn: unzipShape){
    database = [dbUriEdit, dbUserEdit, dbPwdEdit]
    schemaName = 'awjf_waldplan_bestandeskarte_v1'
    tableName = 'waldplan_bestandeskarte'
    dataFile = file('upload/wap_bst_es_sicherung_rode_221209_11.shp')
}
